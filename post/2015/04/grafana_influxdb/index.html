<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8"/>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta name="generator" content="Hugo 0.58.1" />
		<title>A 10 minutes walk into Grafana &amp; Influxdb - Fabrice Aneche</title>

		<meta name="description" content="This is a 10 minute tutorial to set up an InfluxDB &#43; Grafana with Go on your Mac, but should work with minor modifcations on your favorite Unix too, it assumes you already have a working Go compiler.
InfluxDB is a database specialized into time series, think store everything associated with a time, makes it perfect for monitoring and graphing values. Grafana is a js frontend capable of reading the data from InfluxDB and graphing it.">


		
	
		




<link rel="stylesheet" href="https://blog.nobugware.com/css/ui.css">

	
		

		<link  rel="stylesheet" href="https://fonts.googleapis.com/css?family=Fira+Mono|Lato|Raleway">

		
	</head>

<body>
<header class="container no-print">
	<div class="u-header">
		<nav class="bar">
	<ul><li>
			<a href="https://blog.nobugware.com/">
				<img class="icon-text" src="https://blog.nobugware.com/img/prev.svg"/>
			</a>
		</li><li><a href="https://blog.nobugware.com/about">About</a></li><li><a href="https://blog.nobugware.com/post/">Post</a></li></ul>
</nav>

	</div>
</header>
<main class="container">

<article>
	<header><hgroup id="brand">
	<h1>A 10 minutes walk into Grafana &amp; Influxdb</h1>
	<h5>
		
		<time datetime="2015-04-02 12:49:04 -0400 -0400">Apr 02, 2015</time>
		<span class="no-print">
			<span>
	</h5>
	
</hgroup>
<hr class="sep" />
</header>
	<p>This is a 10 minute tutorial to set up an <a href="http://influxdb.com/">InfluxDB</a> + <a href="http://grafana.org/">Grafana</a> with Go on your Mac, but should work with minor modifcations on your favorite Unix too, it assumes you already have a working Go compiler.</p>

<p><a href="http://influxdb.com/">InfluxDB</a> is a database specialized into time series, think store everything associated with a time, makes it perfect for monitoring and graphing values.
<a href="http://grafana.org/">Grafana</a> is a js frontend capable of reading the data from InfluxDB and graphing it.</p>

<p><code>brew install influxdb</code></p>

<p>Start <a href="http://influxdb.com/">InfluxDB</a>, and then point your browser to <a href="http://localhost:8083">http://localhost:8083</a> default user is root, password is root and default port is 8086.</p>

<p><code>influxdb -config /usr/local/etc/influxdb.conf</code>
Create a database called test.</p>

<p>Let&rsquo;s test the connection with the db and Go, first install the InfluxDB driver for Go:</p>

<p><code>go get github.com/influxdb/influxdb/client</code>
Test your setup with some code:</p>

<pre><code class="language-go">package main

import (
    &quot;fmt&quot;

    &quot;github.com/influxdb/influxdb/client&quot;
)

func main() {
    c, err := client.NewClient(&amp;client.ClientConfig{
        Username: &quot;root&quot;,
        Password: &quot;root&quot;,
        Database: &quot;test&quot;,
    })

    if err != nil {
        panic(err)
    }

    dbs, err := c.GetDatabaseList()
    if err != nil {
        panic(err)
    }

    fmt.Println(dbs)
}
</code></pre>

<p>If you are good you should see a map containing all your created <a href="http://influxdb.com/">InfluxDB</a> databases.</p>

<p>Now let&rsquo;s measure something real: the time it takes for your http handler to answer.</p>

<pre><code class="language-go">package main

import (
    &quot;fmt&quot;
    &quot;log&quot;
    &quot;math/rand&quot;
    &quot;net/http&quot;
    &quot;time&quot;

    &quot;github.com/influxdb/influxdb/client&quot;
)

var c *client.Client

func mySuperFastHandler(rw http.ResponseWriter, r *http.Request) {
    start := time.Now()
    // sleeping some random time
    rand.Seed(time.Now().Unix())
    i := rand.Intn(1000)
    time.Sleep(time.Duration(time.Duration(i) * time.Millisecond))
    fmt.Fprintf(rw, &quot;Waiting %dms&quot;, i)
    t := time.Since(start)

    // sending the serie
    s := &amp;client.Series{
        Name:    &quot;myhostname.nethttp.mySuperFastHandler.resp_time&quot;,
        Columns: []string{&quot;duration&quot;, &quot;code&quot;, &quot;url&quot;, &quot;method&quot;},
        Points: [][]interface{}{
            []interface{}{int64(t / time.Millisecond), 200, r.RequestURI, r.Method},
        },
    }
    err := c.WriteSeries([]*client.Series{s})
    if err != nil {
        log.Println(err)
    }
}

func main() {
    var err error
    c, err = client.NewClient(&amp;client.ClientConfig{
        Username: &quot;root&quot;,
        Password: &quot;root&quot;,
        Database: &quot;test&quot;,
    })
    if err != nil {
        panic(err)
    }

    http.HandleFunc(&quot;/&quot;, mySuperFastHandler)
    http.ListenAndServe(&quot;:8080&quot;, nil)
}
</code></pre>

<p>This is not very useful as it&rsquo;s measuring the time to write to the ResponseWriter that&rsquo;s why I&rsquo;ve added some random time but you get the sense.
It will save a serie per request as: duration, status code, url, http method, the name of the serie is important as many tools (as Graphite) are using the dots as separator, so think twice before naming your serie.
Point your browser to <a href="http://localhost:8080">http://localhost:8080</a> and reload the page several times.</p>

<p>Now that we have data let&rsquo;s browse them with the <a href="http://influxdb.com/">InfluxDB</a> browser, go to the <a href="http://influxdb.com/">InfluxDB</a> admin and hit &ldquo;explore data&rdquo; and select with:</p>

<p><code>SELECT duration FROM myhostname.nethttp.mySuperFastHandler.resp_time WHERE code = 200;</code></p>

<p><img src="http://kdl.nobugware.com/public/shotinflux.png" alt="Image Alt" /></p>

<p>You should be able to see the inserted data points.</p>

<p>Now let&rsquo;s work with <a href="http://grafana.org/">Grafana</a>, download the tar gz, uncompress it somewhere, <a href="https://gist.githubusercontent.com/akhenakh/39e1950bf95859878748/raw/f8b0531d88cfb481213541253329c5730c4a2b06/config.js">copy this demo config.js</a> file in the root directory of <a href="http://grafana.org/">Grafana</a>.
Go to the <a href="http://influxdb.com/">InfluxDB</a> admin with your browser and add a new database called &ldquo;grafana&rdquo;.</p>

<p>In your web browser, open the file index.html in the <a href="http://grafana.org/">Grafana</a> directory, you should see a the <a href="http://grafana.org/">Grafana</a> interface edit the default graph, enter the query as follow:</p>

<ul>
<li>click on series it will complete with myhostname.nethttp.mySuperFastHandler.resp_time</li>
<li>In alias type $0 $2, it will use the 1st part and the 3rd part of the name (remember the dots) so it will display myhostname mySuperFastHandler</li>
<li>Finally click on mean and choose duration in the completion, then add code = 200 as where clause.<br /></li>
</ul>

<p>Hit save and you are done !</p>

<p><img src="http://kdl.nobugware.com/public/shotgrafana.png" alt="Image Alt" /></p>

<p>There is so much more you can do with <a href="http://influxdb.com/">InfluxDB</a> &amp; <a href="http://grafana.org/">Grafana</a>, it&rsquo;s really simple to collect and display, hope you want to go further after this.
You can look at my <a href="https://github.com/akhenakh/influxhandler">generic net/http handler for <a href="http://influxdb.com/">InfluxDB</a> on Github</a> that can be integrated into your code.</p>

</article>
<nav class="no-print post-nav">

	<a class="prev-post" href="https://blog.nobugware.com/post/2015/01/02/run-a-full-wikipedia-copy-from-any-computers/">
		<img class="icon-text" src="https://blog.nobugware.com/img/prev.svg"/>Run a full Wikipedia copy from any computers</a>


	<a class="next-post" href="https://blog.nobugware.com/post/migrate_to_hugo/">Migrate to Hugo<img class="icon-text" src="https://blog.nobugware.com/img/next.svg"/>
	</a>

</nav>





			<hr class="sep" />
		</main>
		<footer class="container no-print">
			<div class="u-footer">
				

<a href="https://github.com/akhenakh/"><img class="icon-social" src="https://blog.nobugware.com/img/github.svg" alt="Github"/></a>


<a href="https://twitter.com/akhenakh"><img class="icon-social" src="https://blog.nobugware.com/img/twitter.svg" alt="Twitter"/></a>

<a href="https://blog.nobugware.com/index.xml" target="_blank"><img class="icon-social" src="https://blog.nobugware.com/img/feed.svg" alt="Feed"></a>

				<p>
					
					Theme used: <a href="https://github.com/yursan9/manis-hugo-theme">Manis</a><br>
					
					
					
				</p>
				
				<a href="#brand">
					<img class="icon-text" src="https://blog.nobugware.com/img/toup.svg" alt="To Up"/>
					<span>Back to Up</span>
				</a>
				
			</div>
		</footer>
		
	</body>
</html>

