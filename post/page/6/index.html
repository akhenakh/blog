<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Posts &middot; Fabrice Aneche</title>

    <meta name="description" content="">

    <meta name="generator" content="Hugo 0.55.3" />
    <meta name="twitter:card" content="summary">
    
    <meta name="twitter:title" content="Posts &middot; Fabrice Aneche">
    <meta name="twitter:description" content="">

    <meta property="og:type" content="article">
    <meta property="og:title" content="Posts &middot; Fabrice Aneche">
    <meta property="og:description" content="">

    <link href='//fonts.googleapis.com/css?family=Source+Sans+Pro:400,700|Oxygen:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/pure-min.css">
    <!--[if lte IE 8]>
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/grids-responsive-old-ie-min.css">
    <![endif]-->
    <!--[if gt IE 8]><!-->
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/grids-responsive-min.css">
    <!--<![endif]-->

    <link rel="stylesheet" href="https://blog.nobugware.com/css/all.min.css">
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet">

    <link rel="alternate" type="application/rss+xml" title="Fabrice Aneche" href="https://blog.nobugware.com/index.xml" />
    <link href="https://blog.nobugware.com/css/prism.css" rel="stylesheet" />
</head>
<body>


<div id="layout" class="pure-g">
    <div class="sidebar pure-u-1 pure-u-md-1-4">
    <div class="header">
        <hgroup>
            <h1 class="brand-title"><a href="https://blog.nobugware.com">Fabrice Aneche</a></h1>
            <h2 class="brand-tagline"></h2>
        </hgroup>

        <nav class="nav">
            <ul class="nav-list">
                
                <li class="nav-item">
                    <a class="pure-button" href="http://www.nobugware.com"><i class="fa fa-building-o"></i> Hiring</a>
                </li>
                
                
                <li class="nav-item">
                    <a class="pure-button" href="https://twitter.com/akhenakh"><i class="fa fa-twitter"></i> Twitter</a>
                </li>
                
                
                <li class="nav-item">
                    <a class="pure-button" href="https://github.com/akhenakh "><i class="fa fa-github-alt"></i> github</a>
                </li>
                
                <li class="nav-item">
                    <a class="pure-button" href="https://blog.nobugware.com/index.xml"><i class="fa fa-rss"></i> rss</a>
                </li>
            </ul>
        </nav>
    </div>
</div>


    <div class="content pure-u-1 pure-u-md-3-4">
        <div>
            
            <div class="posts">
                
                <h1 class="content-subhead">05 Jan 2012, 23:59</h1>
                <section class="post">
                    <header class="post-header">

                        <a href="https://blog.nobugware.com/post/2012/01/05/compile-and-run-xv6-mac-os-x-6828/" class="post-title">compile and run xv6 on Mac Os X 6.828</a>

                        <p class="post-meta">
                            
                            
                        </p>
                    </header>

                    <div class="post-description">
                        <p>The MIT has created <a href="http://pdos.csail.mit.edu/6.828/2011/xv6.html">xv6</a>: an
operating system for learning purpose</p>

<p>This works better and takes less time to create a working environnement for
xv6 on Mac Os X, than the recommandations proposed on<a href="http://pdos.csail.mit.edu/6.828/2011/tools.html"> Tools used in
6.828</a> simply run this</p>

<pre><code>port install i386-elf-gcc
port install qemu
</code></pre>

<p>And change the Makefile like this:</p>

<pre><code>-#TOOLPREFIX = i386-jos-elf-
+TOOLPREFIX = i386-elf-

-#QEMU = 
+QEMU = /opt/local/bin/qemu-system-i386

-CC = $(TOOLPREFIX)gcc
+CC = $(TOOLPREFIX)gcc-4.3.2
</code></pre>

<p><a href="http://dl.dropbox.com/u/524733/gdb-
target-i386-elf.bz2">Here is a working gdb binary</a> simply bunzip2 it then invoke it from the xv6 directory
souce tree, (tested on osx Lion).</p>

<p>make qemu will compile and run xv6 in qemu</p>

<p>make qemu-dbg will run xv6 in debug mode, run gdb-target-i386-elf and c for
continue</p>

<p>Enjoy, thanks MIT.</p>

                    </div>
                </section>
                
                <h1 class="content-subhead">15 Nov 2011, 11:53</h1>
                <section class="post">
                    <header class="post-header">

                        <a href="https://blog.nobugware.com/post/2011/11/15/compile-gevent-osx-or-freebsd-pip/" class="post-title">compile gevent on OSX or FreeBSD with pip</a>

                        <p class="post-meta">
                            
                            
                                under 
                                
                                <a class="post-category post-category-Python" href="https://blog.nobugware.com/categories/python">Python</a>
                            
                        </p>
                    </header>

                    <div class="post-description">
                        <p>It&rsquo;s more a reminder to myself, gevent depends on libevent2 but the setup.py
doesn&rsquo;t correcty look for it, a simple solution:</p>

<pre><code>export CFLAGS=-I/usr/local/include
export LDFLAGS=-L/usr/local/lib
pip install gevent
</code></pre>

<p>change it for /opt/local/&hellip; if you are on OSX or you will get a bunch of
errors</p>

<pre><code>   /Developer/usr/bin/llvm-gcc-4.2 -fno-strict-aliasing -fno-common -dynamic -pipe -O2 -DNDEBUG -g -fwrapv -O3 -Wall -Wstrict-prototypes -I/opt/local/Library/Frameworks/Python.framework/Versions/2.7/include/python2.7 -c gevent/core.c -o build/temp.macosx-10.7-x86_64-2.7/gevent/core.o
    In file included from gevent/core.c:225:
    gevent/libevent.h:9:19: error: event.h: No such file or directory
    gevent/libevent.h:38:20: error: evhttp.h: No such file or directory
    gevent/libevent.h:39:19: error: evdns.h: No such file or directory
</code></pre>

<p>By the way here is the ultimate stacks for python web dev ;)</p>

<pre><code>pip install flask 
pip install requests
export CFLAGS=-I/usr/local/include
export LDFLAGS=-L/usr/local/lib
pip install gevent
pip instal ujson
pip install validictory
</code></pre>

                    </div>
                </section>
                
                <h1 class="content-subhead">14 Oct 2011, 13:57</h1>
                <section class="post">
                    <header class="post-header">

                        <a href="https://blog.nobugware.com/post/2011/10/14/freebsd-90-guest-virtio-support-in-kvm/" class="post-title">FreeBSD 9.0 guest with virtio support in KVM</a>

                        <p class="post-meta">
                            
                            
                                under 
                                
                                <a class="post-category post-category-FreeBSD" href="https://blog.nobugware.com/categories/freebsd">FreeBSD</a>
                            
                        </p>
                    </header>

                    <div class="post-description">
                        <p>Performance are really bad for FreeBSD in KVM, one solution is to use
paravirtualized driver, virIO.</p>

<p>At the time of writing FreeBSD 9.0 is beta 3 and the last commit in the virtio
project is
<a href="http://svnweb.freebsd.org/base?view=revision&amp;revision=225710">225710</a></p>

<pre><code>cd /usr/src/sys/dev
svn co http://svn.freebsd.org/base/projects/virtio/sys/dev/virtio
cd /usr/src/sys/modules
svn co http://svn.freebsd.org/base/projects/virtio/sys/modules/virtio
cd /usr/src/sys/modules/virtio

make install
</code></pre>

<p>add this to /boot/loader.conf</p>

<pre><code>virtio_load=&quot;YES&quot;
virtio_pci_load=&quot;YES&quot;
virtio_blk_load=&quot;YES&quot;
if_vtnet_load=&quot;YES&quot;
virtio_balloon_load=&quot;YES&quot;

# dmesg | grep -i  virtio
vtnet0:  on virtio_pci0
virtio_pci1:  port 0xc060-0xc07f irq 11 at device 4.0 on pci0
vtballoon0:  on virtio_pci1
virtio_pci2:  port 0xc080-0xc0bf mem 0xf2040000-0xf2040fff irq 10 at device 5.0 on pci0
vtblk0:  on virtio_pci2
</code></pre>

<p>It needs further tests, but seems to work except for the net driver which give
me no links, (you can still use the previous net driver in KVM)</p>

<p>EDIT: the vtnet driver issue is solve and should be in the trunk</p>

                    </div>
                </section>
                
                <h1 class="content-subhead">14 Oct 2011, 11:00</h1>
                <section class="post">
                    <header class="post-header">

                        <a href="https://blog.nobugware.com/post/2011/10/14/install-freebsd-90-zfs-root/" class="post-title">Install FreeBSD 9.0 with ZFS root</a>

                        <p class="post-meta">
                            
                            
                                under 
                                
                                <a class="post-category post-category-FreeBSD" href="https://blog.nobugware.com/categories/freebsd">FreeBSD</a>
                            
                        </p>
                    </header>

                    <div class="post-description">
                        <p>The &ldquo;new&rdquo; FreeBSD installer does not give you the options to simply install
ZFS as root, so sad, here is how to do it.</p>

<p>Most installation recommand to install / in the zpool root, which is not
always clean, for example a recursive snapshot will snapshot your swap &hellip;</p>

<pre><code>#Boot cd and choose shell:


umount /dev/md1
mdmfs -s 1024M md1 /tmp

gpart destroy -F ada0

gpart create -s gpt ada0

gpart add -b 34 -s 64k -t freebsd-boot ada0
#gpart add -s 4G -t freebsd-swap -l swap0 ada0
gpart add -t freebsd-zfs -l disk0 ada0
gpart bootcode -b /boot/pmbr -p /boot/gptzfsboot -i 1 ada0

zpool destroy rpool
# use -f if you already have a zpool
zpool create -f rpool /dev/gpt/disk0

zfs set checksum=fletcher4 rpool
zfs create rpool/root
zfs set mountpoint=none rpool
zfs set mountpoint=/mnt rpool/root

zfs create -o canmount=off  rpool/root/usr
zfs create  -o canmount=off rpool/root/var
zfs create -o compression=on -o exec=on -o setuid=off rpool/root/tmp
zfs create -o compression=gzip -o setuid=off  rpool/root/usr/ports
zfs create -o compression=off -o exec=off -o setuid=off rpool/root/usr/ports/distfiles
zfs create -o compression=off -o exec=off -o setuid=off rpool/root/usr/ports/packages
zfs create -o compression=gzip -o exec=off -o setuid=off  rpool/root/usr/src
zfs create -o compression=lzjb rpool/root/usr/obj
zfs create -o compression=lzjb  -o exec=off     -o setuid=off   rpool/root/var/crash
zfs create -o compression=off -o exec=off -o setuid=off   rpool/root/var/empty
zfs create -o compression=lzjb  -o exec=on -o setuid=off   rpool/root/var/tmp

zpool export rpool
zpool import -o cachefile=/tmp/zpool.cache rpool
chmod 1777 /mnt/tmp
chmod 1777 /mnt/var/tmp

sh
cd /usr/freebsd-dist
export DESTDIR=/mnt
for file in base.txz lib32.txz kernel.txz doc.txz ports.txz src.txz;
do (cat $file | tar --unlink -xpJf - -C ${DESTDIR:-/}); done

cp /tmp/zpool.cache /mnt/boot/zfs/zpool.cache
echo 'zfs_enable=&quot;YES&quot;' &gt;&gt; /mnt/etc/rc.conf
echo 'zfs_load=&quot;YES&quot;' &gt;&gt; /mnt/boot/loader.conf
echo 'vfs.root.mountfrom=&quot;zfs:rpool/root&quot;' &gt;&gt; /mnt/boot/loader.conf

zfs set readonly=on rpool/root/var/empty
touch /mnt/etc/fstab
zfs umount -a

zfs set mountpoint=legacy rpool/root
zfs set mountpoint=/tmp rpool/root/tmp
zfs set mountpoint=/usr rpool/root/usr
zfs set mountpoint=/var rpool/root/var
zpool set bootfs=rpool/root rpool
zfs create -V 2G rpool/swap
zfs set checksum=off rpool/swap
zfs set org.freebsd:swap=on rpool/swap


#reboot

# if close to 4G of memory
#echo &quot;vfs.zfs.prefetch_disable=0&quot; &gt;&gt; /boot/loader.conf

#echo WRKDIRPREFIX=/usr/obj &gt;&gt; /etc/make.conf
#passwd root
</code></pre>

<p>This installation has been made on a Linux KVM, later blog post will follow
how to enable Dtrace, virtio &hellip;</p>

                    </div>
                </section>
                
                <h1 class="content-subhead">31 Aug 2011, 15:40</h1>
                <section class="post">
                    <header class="post-header">

                        <a href="https://blog.nobugware.com/post/2011/08/31/gimp-273-osx/" class="post-title">Gimp 2.7.3 on OSX</a>

                        <p class="post-meta">
                            
                            
                        </p>
                    </header>

                    <div class="post-description">
                        <p>Gimp 2.7.3 has been released but no one ports it to OSX already here is an
ugly working way.</p>

<p>EDIT: The macport is now up to date so no need to do this anymore !</p>

<p>It needs a lot of dependencies, get it via macports:</p>

<p>run port sync</p>

<p>Edit /opt/local/var/macports/sources/rsync.macports.org/release/ports/graphics
/gegl/Portfile</p>

<p>Change version to 0.1.6 and master_sites</p>

<blockquote>
<p>version  0.1.6</p>
</blockquote>

<p>master_sites  <a href="ftp://ftp.gimp.org/pub/gegl/0.1/">ftp://ftp.gimp.org/pub/gegl/0.1/</a></p>

<p>remove the path line about atch-gegl-buffer-gegl-buffer.c</p>

<p>Edit /opt/local/var/macports/sources/rsync.macports.org/release/ports/graphics
/babl/Portfile change version and master_sites</p>

<blockquote>
<p>version  0.1.4</p>
</blockquote>

<p>master_sites  <a href="ftp://ftp.gimp.org/pub/babl/0.1/">ftp://ftp.gimp.org/pub/babl/0.1/</a></p>

<p>run macports</p>

<blockquote>
<p>port install babl</p>
</blockquote>

<p>port install gegl</p>

<p>port install aalib iso-codes libmng librsvg libexif libwmf poppler openjpeg
lcms2 poppler-data libwmf poppler openjpeg lcms2 poppler-data py27-gtk
py27-cairo py27-numpy  py27-gobject librsvg libopenraw  dbus-glib</p>

<p>Download gimp 2.7.3 and uncompress it</p>

<blockquote>
<p>export
PATH=$PATH:/opt/local/Library/Frameworks/Python.framework/Versions/2.7/bin</p>
</blockquote>

<p>export CPPFLAGS=&ldquo;-I/opt/local/include&rdquo;</p>

<p>export PYGTK-LIBS=&ldquo;-L/opt/local/lib&rdquo;</p>

<p>export LDFLAGS=&ldquo;-L/opt/local/lib&rdquo;</p>

<p>export PYGTK_CFLAGS=&ldquo;-I/opt/local/include -I/opt/local//Library/Frameworks/Pyt
hon.framework/Versions/2.7/include/python2.7/pygtk-2.0
-I/opt/local/include/glib-2.0 -I/opt/local/include/gtk-2.0
-I/opt/local/include/atk-1.0 -I/opt/local/include/cairo
-I/opt/local/include/pango-1.0 -I/opt/local/include/glib-2.0
-I/opt/local/include/pixman-1 -I/opt/local/include/freetype2
-I/opt/local/include/libpng14&rdquo;</p>

<p>./configure &ndash;prefix=/opt/local/gimp-2.7.3  &ndash;without-mac-twain</p>

<blockquote>
<p>make -j 8</p>

<p>make install</p>

<p>/opt/local/gimp-2.7.3/bin/gimp-2.7</p>
</blockquote>

                    </div>
                </section>
                
                <h1 class="content-subhead">16 Aug 2011, 12:00</h1>
                <section class="post">
                    <header class="post-header">

                        <a href="https://blog.nobugware.com/post/2011/08/16/enhance-your-python/" class="post-title">Enhance your Python</a>

                        <p class="post-meta">
                            
                            
                                under 
                                
                                <a class="post-category post-category-Python" href="https://blog.nobugware.com/categories/python">Python</a>
                            
                        </p>
                    </header>

                    <div class="post-description">
                        <p>Nohting new here but a list of what you should read to be a better Python
developer, for intermediate and advanced Pythoners, in no particular order.</p>

<ul>
<li><a href="http://homepage.mac.com/s_lott/books/python/html/index.html">Building skills in Python</a> a very complete language description</li>
<li><a href="http://python.net/~goodger/projects/pycon/2007/idiomatic/handout.html">Code like a Pythonista</a> useful quick list of good practice. I&rsquo;m reading it again and again to get it automatically</li>
<li><a href="http://stackoverflow.com/questions/101268/hidden-features-of-python">The hidden features of Python</a> question on Stackoverflow, a must read</li>
<li><a href="http://stackoverflow.com/questions/100003/what-is-a-metaclass-in-python">What is a metaclass</a></li>
<li><a href="http://www.dabeaz.com/generators/">Generator Tricks for Systems Programmers</a>, <a href="http://www.dabeaz.com/coroutines/">A curious Course Coroutines and Concurrency</a> and <a href="http://stackoverflow.com/questions/231767/the-python-yield-keyword-explained">the Python yield keyword explained</a> on Stackoverflow, all about yield</li>
<li><a href="http://video.google.com/videoplay?docid=7760178035196894549">Advanced Python: (or understanding Python)</a> Video from Google</li>
<li><a href="http://stackoverflow.com/questions/739654/understanding-python-decorators/1594484">Understanding Python decorators</a>, then use it with <a href="http://wiki.python.org/moin/PythonDecoratorLibrary">Python Decorator Library</a></li>
<li><a href="http://stackoverflow.com/questions/2573135/python-progression-path-from-apprentice-to-guru">Python progression path - From apprentice to guru</a>, good advises to mastering Python</li>
<li><a href="http://www.python.org/dev/peps/pep-0008/">PEP8</a> reading, and <a href="http://www.logilab.org/857">pylint</a> usage</li>
<li><a href="http://diveintopython3.org/">Dive into Python 3</a> somes parts are boring but somes are greats</li>
<li><a href="http://docs.python.org/howto/doanddont.html">Idioms and Anti-Idioms in Python</a>, <a href="http://www.fantascienza.net/leonardo/ar/python_best_practices.html">Python best practices</a></li>
<li><a href="http://www.cafepy.com/article/python_attributes_and_methods/python_attributes_and_methods.html">Python Attributes and Methods</a></li>
<li><a href="http://docs.python-guide.org/en/latest/index.html">The Hitchhiker&rsquo;s Guide to Python</a>

<br /></li>
</ul>

<p>A special mention for the <a href="http://www.tornadoweb.org/">Tornado web framework</a>,
the lack of documentation makes reading the source code a lot and it&rsquo;s very
didactic, <a href="http://golubenco.org/?p=16">Understanding the code inside Tornado</a>
is a very great blog post about asynchronous programming, the Python<a href="http://docs.python.org/library/asyncore.html"> asyncore
module</a> and <a href="http://krondo.com/wp-content/uploads/2009/08
/twisted-intro.html">An Introduction to
Asynchronous Programming</a></p>

<p>Of course <a href="http://pycon.tv/">PyCon videos</a>.</p>

<ul>
<li><a href="http://agiliq.com/books/djangodesignpatterns/">Django patterns</a></li>
</ul>

                    </div>
                </section>
                
                <h1 class="content-subhead">31 Mar 2011, 21:06</h1>
                <section class="post">
                    <header class="post-header">

                        <a href="https://blog.nobugware.com/post/2011/03/31/freebsd-zfs/" class="post-title">(Re)Discovering FreeBSD and ZFS</a>

                        <p class="post-meta">
                            
                            
                                under 
                                
                                <a class="post-category post-category-FreeBSD" href="https://blog.nobugware.com/categories/freebsd">FreeBSD</a>
                            
                        </p>
                    </header>

                    <div class="post-description">
                        <p>Since Sun&rsquo;s killers euh Oracle shutdown OpenSolaris, FreeBSD is becoming more
and more attracting with ZFS port, you should really give it a try (We are
back baby).</p>

<p>Here is a fast installation of FreeBSD with a ZFS root.</p>

<p>Download <a href="http://mfsbsd.vx.sk/">http://mfsbsd.vx.sk/</a>, a special iso image that will give you a ZFS on root FreeBSD with no pain.</p>

<p>Note that I&rsquo;m using it over KVM on Gentoo: (kvm -hda /dev/vg0/freebsdvm_root -m 4096 -cdrom /opt/data/kvm/installer/mfsbsd-se-8.2-amd64.iso -net nic -net user -boot d), but you can test it with Virtualbox, vmware, real installation &hellip;</p>

<p>At prompt login as root with password **mfsroot.</p>

<pre><code>mount_cd9660 /dev/acd- /cdrom_  
zfsinstall -d /dev/ad0 -t /cdrom/8.2-RELEASE-amd64.tar.xz  
chroot /mnt  
vi /etc/rc.conf
</code></pre>

<p>Add:</p>

<pre><code>sshd_enable=&quot;YES_  
hostname=&quot;freebsdvm&quot;  
ifconfig_re0=&quot;DHCP&quot;  
</code></pre>

<pre><code>zfs create -V 2G tank/swap  
zfs set org.freebsd:swap=on tank/swap  
zfs set checksum=off tank/swap  
reboot  
</code></pre>

<p>Restart your vm (kvm -hda /dev/vg0/freebsdvm_root -m 4096 -net nic -net user )</p>

<p>log in as root no password<br />
set a password</p>

<pre><code>zfs set atime=off tank   
zfs create tank/root/usrports _# this is not a typo 
zfs set compression=gzip tank/root/usrports  
zfs set mountpoint=/usr/ports tank/root/usrports  
zfs create tank/root/usrports/distfiles  
zfs compression=off tank/root/usrports/distfiles
</code></pre>

<p>Install the ports with the methods you want. (<a href="http://www.freebsd.org/doc/handbook/ports-using.html">http://www.freebsd.org/doc/handbook/ports-using.html</a>)</p>

<pre><code>portsnap fetch  
portsnap extract  
      
cd /usr/ports/shell/bash  
make install clean  
</code></pre>

<p>Adduser Put your user in the wheel group (admin)_</p>

<pre><code>cd /usr/ports/ports-mgmt/portupgrade 
make install clean  
      
cd /usr/ports/security/sudo  
make install clean
      
cd /usr/ports/ports-mgmt/portaudit  
make install clean  
      
cd /usr/ports/sysutils/lsof  
make install clean

# update your system  
      
freebsd-update fetch  
freebsd-update install  
   
portsnap fetch  
portsnap update  
      
portaudit -F  
      
portupgrade -ai  
</code></pre>

                    </div>
                </section>
                
                <h1 class="content-subhead">02 Feb 2011, 22:06</h1>
                <section class="post">
                    <header class="post-header">

                        <a href="https://blog.nobugware.com/post/2011/02/02/gentoo-lvmraid-root/" class="post-title">Gentoo lvm&#43;raid root</a>

                        <p class="post-meta">
                            
                            
                        </p>
                    </header>

                    <div class="post-description">
                        <p>Gentoo support for lvm root is still a pain in the ass, here is a working
solution.</p>

<p>Assuming you have 2 disks same size to be mirrored.</p>

<p>You want a mirrored /boot and a big lvm.</p>

<p>Start a normal gentoo installation with this disks layout:</p>

<pre><code>fdisk -l /dev/sda
   Device Boot      Start         End      Blocks   Id  System
/dev/sda1   *           1          31      248976   fd  Linux raid autodetect
/dev/sda2              32      242246  1945591987+  fd  Linux raid autodetect

fdisk -l /dev/sdb
   Device Boot      Start         End      Blocks   Id  System
/dev/sdb1   *           1          31      248976   fd  Linux raid autodetect
/dev/sdb2              32      242246  1945591987+  83  Linux raid autodetect
</code></pre>

<p>Set both disk the boot flags on the first partition and set all partitions to
FD Linux raid autodetect.</p>

<pre><code>mdadm --create /dev/md0 --level=1 --raid-devices=2 /dev/sda1 /dev/sdb1
mdadm --create /dev/md1 --level=1 --raid-devices=2 /dev/sda2 /dev/sdb2
</code></pre>

<p>If it complains about another array by this is name is already running or disk
used.</p>

<p>First stop them all:</p>

<pre><code>cat /proc/mdstat
</code></pre>

<p>Identify the old arrays then stop it:</p>

<pre><code>mdadm --stop /dev/md??
</code></pre>

<p>Clean the partition if necessaray</p>

<pre><code>dd if=/dev/zero of=/dev/sda1 count=100 bs=1024
dd if=/dev/zero of=/dev/sda1 count=100 bs=1024
</code></pre>

<p>Create the boot:</p>

<pre><code>mkfs.ext3 /dev/md0
</code></pre>

<p>Create the lvm root and swap:</p>

<pre><code>pvcreate /dev/md1
vgcreate vg0 /dev/md1
lvcreate  -L10G -nroot vg0
lvcreate  -L16G -nswap vg0
# set the minfree to 0 and increase the number of inodes to 600k
mkfs.ext4 -m0 -N 600000  /dev/vg0/root
mkswap /dev/vg0/swap
</code></pre>

<p>Mount them all !</p>

<pre><code>mount /dev/vg0/root /mnt/gentoo
mkdir /mnt/gentoo/boot
mount /dev/md0 /mnt/gentoo/boot
</code></pre>

<p>Continue with the standard install procedure, mount -t proc &hellip;</p>

<p>After the emerge &ndash;sync in the install procedure get back here:</p>

<pre><code>emerge lvm2 dmadm genkernel
emerge gentoo-sources
mdadm --examine --scan &gt;&gt; /etc/mdadm.conf
</code></pre>

<p>Edit /etc/genkernel.conf:</p>

<p>Set LVM=&ldquo;yes&rdquo;</p>

<p>Set MDADM=&ldquo;yes&rdquo;</p>

<p>Edit /etc/fstab</p>

<pre><code>/dev/md0        /boot       ext3        noauto,noatime  1 2
/dev/vg0/root       /       ext4        noatime     0 1
/dev/vg0/swap       none        swap        sw      0 0
</code></pre>

<p>Compile your kernel with genkernel (note that if you want to compile your own
kernel without genkernel this is possible with the command genkernel
initramfs).</p>

<pre><code>genkernel --menuconfig all
</code></pre>

<p>Continue to normal procedure until grub, apply grub on both disks:</p>

<pre><code>grub&gt; root (hd0,0) 
grub&gt; setup (hd0)   
grub&gt; root (hd2,0) 
grub&gt; setup (hd1)   
grub&gt; quit           
</code></pre>

<p>Then edit grub.conf</p>

<pre><code>title Gentoo
root (hd0,0)
kernel /boot/kernel-genkernel-x86_64-2.6.36-gentoo-r5 root=/dev/ram0 real_root=/dev/vg0/root dolvm domdadm lvmraid=/dev/md1
initrd /boot/initramfs-genkernel-x86_64-2.6.36-gentoo-r5
</code></pre>

<p>Explanation, for lvm to find his disks, we need a ramfs with the static lvm
command, but to find back our raids md we also need mdadm to save the config
somewhere, that&rsquo;s exactly what the genkernel initramfs is doing.</p>

<p>Then we invoke the kernel with ramfs and domdadm dolvm and lvmraid.</p>

<p>You can use the initramfs with your own kernel, you only have to be sure all
needed hardware drivers to detect the disks are in the kernel, and not as
modules.</p>

<p>Remember that when gentoo stable will update to baselayout2 you will have to
add rc-update add mdraid boot.</p>

<p>EDIT: on recent Gentoo I have to add this to kernel boot line:</p>

<pre><code>kernel /boot/kernel-genkernel-x86_64-3.1.10-gentoo-r1 root=/dev/ram0 init=/linuxrc real_root=/dev/vg0/root udev dolvm domdadm gentoo=nodevfs lvmraid=/dev/md1 rootfstype=ext4
</code></pre>

                    </div>
                </section>
                
                <h1 class="content-subhead">28 Jan 2011, 11:52</h1>
                <section class="post">
                    <header class="post-header">

                        <a href="https://blog.nobugware.com/post/2011/01/28/amazing-piece-electonic/" class="post-title">An amazing piece of electonic</a>

                        <p class="post-meta">
                            
                            
                        </p>
                    </header>

                    <div class="post-description">
                        <p>Sparkfun and others sell a 434Mhz
<a href="http://www.sparkfun.com/products/8946">transmitter</a> and a
<a href="http://www.sparkfun.com/products/8949">receiver</a> for €2.88 and €3.61.</p>

<p>This version receives at 2400bauds but there is a 4800 bauds version.</p>

<p>Simply connect the transmitter to an arduino pin then your are done (almost).</p>

<p>My first try was to follow the example from sparkfun, which simply read a
value from the receiver:</p>

<pre><code>// read in values, debug to computer
    
if (Serial.available() &gt; 0) {
      incomingByte = Serial.read();
      Serial.println(incomingByte, DEC);
}
</code></pre>

<p>This has collected a ton of garbage (without emitting).</p>

<p>The answer was to use
<a href="http://www.open.com.au/mikem/arduino/VirtualWire.pdf">OpenWire</a> an amazing
piece of software &hellip; that handles checksuming for you, just connect to your
arduino pin 12 for TX, and 11 for RX then you are done !</p>

<p>This is working like a charm in all my house without requiring any antennas.</p>

<p>You can get all your Arduinos connected for less than 7€ !</p>

<p>PS: Sparkfun are great dealers this parts was missing in the first shipping
they send it again in priority mail: 48 hours from USA to France ;)</p>

<p><a href="http://kdl.nobugware.com/public/rflink.jpg"><img src="http://kdl.nobugware.com/public/rflink.jpg" alt="" /></a></p>

                    </div>
                </section>
                
                <h1 class="content-subhead">19 Jan 2011, 16:50</h1>
                <section class="post">
                    <header class="post-header">

                        <a href="https://blog.nobugware.com/post/2011/01/19/all-my-digital-life/" class="post-title">All my digital life</a>

                        <p class="post-meta">
                            
                            
                        </p>
                    </header>

                    <div class="post-description">
                        <p>In a tag cloud !</p>

<p><a href="http://kdl.nobugware.com/public/wordle2.jpg"><img src="http://kdl.nobugware.com/public/wordle2.jpg" alt="" /></a></p>

<p>This tag cloud has been generated with
<a href="http://www.wordle.net/compose">Wordle</a>, the words are extracted from title&rsquo;s
posts for this services.</p>

<ul>
<li>My facebook</li>
<li>My twitter</li>
<li>My Flickr</li>
<li>My shared Google Reader articles</li>
<li>My Tumbler</li>
<li>My Picasa</li>
<li>and this blog</li>
</ul>

<p>Parsed and sorted with Python via the friendfeed json API.</p>

<p>Data since 2008-11-19, commons french or english words removed, iphone word
divide by 2 ;)</p>

<p>Thanks to <a href="http://friendfeed.com/">Friendfeed</a> service to aggregate my data,
and no thanks to Facebook for killing it.</p>

                    </div>
                </section>
                
            </div>
            
<div class="pagination">
  <nav role="pagination" class="post-list-pagination">
      
      <a href="https://blog.nobugware.com/post/page/5/" class="post-list-pagination-item pure-button post-list-pagination-item-prev">
        <i class="fa fa-angle-double-left"></i>&nbsp;Newer
      </a>
      
    <span class="post-list-pagination-item post-list-pagination-item-current">Page 6 of 9</span>
    
      <a href="https://blog.nobugware.com/post/page/7/" class="post-list-pagination-item pure-button post-list-pagination-item-next">
        Older&nbsp;<i class="fa fa-angle-double-right"></i>
      </a>
    
  </nav>
</div>


            <div class="footer">
    <div class="pure-menu pure-menu-horizontal pure-menu-open">
        <ul>
            <li>Powered by <a class="hugo" href="http://hugo.spf13.com/" target="_blank">hugo</a></li>
        </ul>
    </div>
</div>
<script src="https://blog.nobugware.com/js/all.min.js"></script>
        </div>
    </div>
</div>

<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-1245966-1', 'auto');
ga('send', 'pageview');

</script>

</body>
</html>
