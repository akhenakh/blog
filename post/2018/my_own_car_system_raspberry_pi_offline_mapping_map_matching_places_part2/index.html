<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.123.7"><title>My Own Car System, Rear Camera, Offline Maps & Routing, Map Matching with Go on Raspberry Pi part II - Fabrice Aneche</title>
<meta name=description content="This is my journey building an open source car system with Go & Qt, rear camera, live OpenGL map &mldr;
Cross compilation In Part I, I had to patch qtmultimedia for the camera to work, but Qt compilation is resource hungry, same goes for the osrm compilation, the memory of the Raspberry Pi is too small.
I had to to set up a cross compilation system in my case for armv7h."><link rel=stylesheet href=https://blog.nobugware.com/css/ui.css><script defer src=https://blog.nobugware.com/js/dark-mode.js></script><link disabled id=dark-mode-theme rel=stylesheet href=https://blog.nobugware.com/css/dark.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Fira+Mono|Lato|Raleway"><link rel=stylesheet href=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/ocean.min.css><script src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js></script><script src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.4.0/languages/go.min.js></script><script src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.4.0/languages/yaml.min.js></script></head><body><header class="container no-print"><div class=u-header><nav class=bar><ul><li><a href=https://blog.nobugware.com/><img class=icon-text src=https://blog.nobugware.com/img/prev.svg></a></li><li><img class=icon-text id=dark-mode-toggle src=https://blog.nobugware.com/img/moon-regular.svg alt="Toggle Dark Mode"></a></li><li><a href=https://blog.nobugware.com/about>About</a></li><li><a href=https://blog.nobugware.com/post/>Post</a></li></ul></nav></div></header><main class=container><article><header><hgroup id=brand><h1>My Own Car System, Rear Camera, Offline Maps & Routing, Map Matching with Go on Raspberry Pi part II</h1><h5><time datetime="2018-08-01 00:19:57 -0200 -0200">Aug 01, 2018</time>
<span class=no-print>-
<a href=https://blog.nobugware.com/tags/Geo>Geo</a>
<a href=https://blog.nobugware.com/tags/Go>Go</a>
<a href=https://blog.nobugware.com/tags/Qt>Qt</a>
<span></h5></hgroup><hr class=sep></header><p>This is my journey building an open source car system with Go & Qt, rear camera, live OpenGL map &mldr;</p><h2 id=cross-compilation>Cross compilation</h2><p><a href=https://blog.nobugware.com/post/2018/my_own_car_system_raspberry_pi_offline_mapping/>In Part I</a>, I had to patch qtmultimedia for the camera to work, but Qt compilation is resource hungry, same goes for the osrm compilation, the memory of the Raspberry Pi is too small.</p><p>I had to to set up a <a href=https://wiki.archlinux.org/index.php/Distcc#Arch_Linux_ARM>cross compilation system</a> in my case for armv7h.</p><h2 id=qml-development>QML Development</h2><p>Since most of the application is in <a href=https://en.wikipedia.org/wiki/QML>QML</a>, I&rsquo;ve used the c++ <code>main.cpp</code> launcher as long as possible for the development.<br>At the moment I needed to inject data from the outside world (like the GPS location) to QML via Qt, so I switched to Go using <a href=https://github.com/therecipe/qt>therecipe Qt Go bindings</a>.</p><p>The Go bindings project is young but the main author is really active fixing issues.</p><p>It makes desktop applications easy to code without the assle of C++ (at least for me).</p><p>About QML, by separating the logic and forms using <code>.qml.ui</code> you still can edit your views with <a href=https://wiki.qt.io/Qt_Creator>Qt Creator</a>:<br>That&rsquo;s just the narrative, truth is Creator is really buggy and I edited the ui files by hand most of the time.<br>I worked with Interface Builder on iOS for years, Qt is painful, lack of decent visual editor for QML really hurts.</p><h2 id=serving-the-map-without-internet-access>Serving the map without internet access</h2><p><a href=https://blog.nobugware.com/post/2018/my_own_car_system_raspberry_pi_offline_mapping/>In Part I</a>, we talked about OpenMapTiles and OpenGL rendering, but I needed a web server capable of reading MBTiles format and serving the necessary assets for the map to be rendered.</p><p>I&rsquo;ve created <a href=https://github.com/akhenakh/mbmatch>mbmatch</a> in Go for that purpose so <a href=https://github.com/akhenakh/mocs>mocs</a> can render the map without Internet access, it will also map match the positions in the future.</p><h2 id=experimenting-with-another-touch-screen>Experimenting with another touch screen</h2><p>I&rsquo;m using a less performant but smaller <a href=https://www.amazon.ca/gp/product/B01I9DS2G8>LANDZO 5 Inch Touch Display</a> 800x480<br>This touchscreen is handled as a one button mouse.</p><p>It can be calibrate using <a href=https://github.com/kergoth/tslib/>tslib</a> <code>ts_calibrate</code> command.</p><p>Then in your start env tell Qt to use tslib.</p><pre tabindex=0><code>TSLIB_TSDEVICE=/dev/input/event0
QT_QPA_GENERIC_PLUGINS=tslib:/dev/input/event0
QT_QPA_FB_TSLIB=1
</code></pre><h2 id=gps>GPS</h2><p>Like I said in <a href=https://blog.nobugware.com/post/2018/my_own_car_system_raspberry_pi_offline_mapping/>part I</a>, the Linux gps daemons are using obscure and over complicated protocols so <a href=https://xkcd.com/927/>I&rsquo;ve decided</a> to write my own gps daemon in Go using a gRPC stream interface. You can <a href=https://github.com/akhenakh/gpsd>find it here</a>.</p><p>I&rsquo;m also not satisfied with the map matching of OSRM for real time display, I may rewrite one using <a href=https://github.com/akhenakh/mbmatch>mbmatch</a>.</p><h2 id=pois>POIs</h2><p>I&rsquo;ve started POIs lookups with full text search and geo proximity using <a href=http://github.com/blevesearch/bleve>bleve</a> by exposing an API compatible with the OSM API so it can be used directly by QML Locations.</p><h2 id=night-map>Night Map</h2><p>I&rsquo;m a huge fan of the <a href=https://github.com/altercation/solarized>Solarized colors</a>, I&rsquo;ve made a style for the map you can find it <a href=https://github.com/akhenakh/mocs/blob/master/external/solarized-dark.style>here</a></p><p><img src=https://blog.nobugware.com/img/mocssolarized.jpg alt=Solarized></p><h2 id=speeding-up-boot>Speeding up boot</h2><pre tabindex=0><code>systemctl mask systemd-udev-settle.service
systemctl mask lvm2-activation-net.service
systemctl mask lvm2-monitor.service
</code></pre><h2 id=status>Status</h2><p>The project is far from finished and not ready for everybody but it&rsquo;s fun to play with.</p><p>I&rsquo;ve <a href=https://github.com/akhenakh/mocs>open sourced most of the code for Mocs on github</a>, feel free to contribute.</p></article><nav class="no-print post-nav"><a class=prev-post href=https://blog.nobugware.com/post/2018/my_own_car_system_raspberry_pi_offline_mapping/><img class=icon-text src=https://blog.nobugware.com/img/prev.svg>My Own Car System, Rear Camera, Offline Maps & Routing on Raspberry Pi part I</a>
<a class=next-post href=https://blog.nobugware.com/post/2018/wasm_go_s2_javascript/>Wasm with Go to build an S2 cover map viewer<img class=icon-text src=https://blog.nobugware.com/img/next.svg></a></nav><section id=related><h4>See Also</h4><ul><li><a href=https://blog.nobugware.com/post/2018/my_own_car_system_raspberry_pi_offline_mapping/>My Own Car System, Rear Camera, Offline Maps & Routing on Raspberry Pi part I</a></li><li><a href=https://blog.nobugware.com/post/2018/google-s2-python-jupyter/>Google S2 with Python & Jupyter</a></li><li><a href=https://blog.nobugware.com/post/2017/hacking_temperature_radio_sensors_and_graphing_with_prometheus/>Hacking Temperature Radio Sensors and Graphing with Prometheus</a></li></ul></section><hr class=sep></main><footer class="container no-print"><div class=u-footer><a href=https://github.com/akhenakh/><img class=icon-social src=https://blog.nobugware.com/img/github.svg alt=Github></a>
<a href=https://c.im/@akhenakh><img class=icon-social src=https://blog.nobugware.com/img/mastodon.svg alt=Mastodon></a>
<a href=https://twitter.com/akhenakh><img class=icon-social src=https://blog.nobugware.com/img/twitter.svg alt=Twitter></a><p>Theme used: <a href=https://github.com/yursan9/manis-hugo-theme>Manis</a><br></p><a href=#brand><img class=icon-text src=https://blog.nobugware.com/img/toup.svg alt="To Up">
<span>Back to Up</span></a></div></footer><script>hljs.initHighlightingOnLoad()</script></body></html>