<!doctype html><html lang=en>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=generator content="Hugo 0.89.4">
<title>Nginx SSL + Tomcat (for Confluence) - Fabrice Aneche</title>
<meta name=description content="I have an Nginx frontend to serv everything but confluence which was not happy with my SSLized conf, here is the solution !
This doc is related to confluence but will works with any java apps in a tomcat
First don&rsquo;t use the standalone version of confluence (which is a Tomcat 5.5), use the EAR/WAR tar gz archive.
We need Tomcat 6 cause we will use a &ldquo;Valve&rdquo; [RemoteIPValve](http://tomcat.apa che.org/tomcat-6.0-doc/api/org/apache/catalina/valves/RemoteIpValve.html) that will check for a header (X-Forwarded-Proto) to see if the source request was secured by SSL.">
<link rel=stylesheet href=https://blog.nobugware.com/css/ui.css>
<link rel=stylesheet href="https://fonts.googleapis.com/css?family=Fira+Mono|Lato|Raleway">
</head>
<body>
<header class="container no-print">
<div class=u-header>
<nav class=bar>
<ul><li>
<a href=https://blog.nobugware.com/>
<img class=icon-text src=https://blog.nobugware.com/img/prev.svg>
</a>
</li><li><a href=https://blog.nobugware.com/about>About</a></li><li><a href=https://blog.nobugware.com/post/>Post</a></li></ul>
</nav>
</div>
</header>
<main class=container>
<article>
<header><hgroup id=brand>
<h1>Nginx SSL + Tomcat (for Confluence)</h1>
<h5>
<time datetime="2010-02-12 14:02:03 -0400 -0400">Feb 12, 2010</time>
<span class=no-print>
-
<a href=https://blog.nobugware.com/tags/tomcat>tomcat</a>
<a href=https://blog.nobugware.com/tags/confluence>confluence</a>
<a href=https://blog.nobugware.com/tags/nginx>nginx</a>
<span>
</h5>
</hgroup>
<hr class=sep>
</header>
<p>I have an Nginx frontend to serv everything but confluence which was not happy
with my SSLized conf, here is the solution !</p>
<p>This doc is related to confluence but will works with any java apps in a
tomcat</p>
<p>First don&rsquo;t use the standalone version of confluence (which is a Tomcat 5.5),
use the EAR/WAR tar gz archive.</p>
<p>We need Tomcat 6 cause we will use a &ldquo;Valve&rdquo; [RemoteIPValve](<a href=http://tomcat.apa>http://tomcat.apa</a>
che.org/tomcat-6.0-doc/api/org/apache/catalina/valves/RemoteIpValve.html) that
will check for a header (X-Forwarded-Proto) to see if the source request was
secured by SSL.</p>
<p>Inside tomcat server.xml simply add a Valve configuration in your Host
definition:</p>
<pre tabindex=0><code>&lt;Valve className=&quot;org.apache.catalina.valves.RemoteIpValve&quot;
protocolHeader=&quot;X-Forwarded-Proto&quot;  protocolHeaderHttpsValue=&quot;https&quot; /&gt;
</code></pre><p>In your nginx.conf, just forward the header:</p>
<pre tabindex=0><code>location /confluence {
proxy_pass  http://localhost:8010;
proxy_set_header X-Forwarded-Proto  https;
proxy_set_header Host $http_host;
}
</code></pre><p>This is the same mechanism you will find with rails or Django and Nginx.</p>
<p>Remember to listen only on localhost with Tomcat or your nginx proxy is
useless:</p>
<pre tabindex=0><code>&lt;Connector address=&quot;127.0.0.1&quot; port=&quot;8010&quot; protocol=&quot;HTTP/1.1&quot;
connectionTimeout=&quot;20000&quot;
URIEncoding=&quot;UTF-8&quot;  /&gt;
</code></pre><p>Happy SSL !</p>
<p>Thanks to Super Chinois for the java mess.</p>
</article>
<nav class="no-print post-nav">
<a class=prev-post href=https://blog.nobugware.com/post/2009/11/15/pourquoi-android-ne-peut-pas-gagner-la-guerre-des-smartphones/>
<img class=icon-text src=https://blog.nobugware.com/img/prev.svg>Pourquoi Android ne peut pas gagner la guerre des smartphones ?</a>
<a class=next-post href=https://blog.nobugware.com/post/2010/08/09/using-oracle-django/>Using Oracle with Django<img class=icon-text src=https://blog.nobugware.com/img/next.svg>
</a>
</nav>
<hr class=sep>
</main>
<footer class="container no-print">
<div class=u-footer>
<a href=https://github.com/akhenakh/><img class=icon-social src=https://blog.nobugware.com/img/github.svg alt=Github></a>
<a href=https://twitter.com/akhenakh><img class=icon-social src=https://blog.nobugware.com/img/twitter.svg alt=Twitter></a>
<a href=https://blog.nobugware.com/index.xml target=_blank><img class=icon-social src=https://blog.nobugware.com/img/feed.svg alt=Feed></a>
<p>
Theme used: <a href=https://github.com/yursan9/manis-hugo-theme>Manis</a><br>
</p>
<a href=#brand>
<img class=icon-text src=https://blog.nobugware.com/img/toup.svg alt="To Up">
<span>Back to Up</span>
</a>
</div>
</footer>
<script async src=https://us.umami.is/script.js data-website-id=1566cf98-efb9-475c-b96e-709666a74819></script>
</body>
</html>