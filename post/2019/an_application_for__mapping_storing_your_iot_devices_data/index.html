<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.74.2"><title>An application to map and store your IoT devices data - Fabrice Aneche</title><meta name=description content="Here in Quebec, winter is so cold it can drain your phone battery very fast. I wanted a private and secure solution for my hikes, so I can be followed on a map.
This post will introduce you to LoRaWAN and how to install your own IoT mapping application using open source tools and a new project I&rsquo;m working on written in Go.
Radio Network LoRaWAN is a network layer protocol for managing communication between LoRa devices and gateways."><link rel=stylesheet href=https://blog.nobugware.com/css/ui.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Fira+Mono|Lato|Raleway"></head><body><header class="container no-print"><div class=u-header><nav class=bar><ul><li><a href=https://blog.nobugware.com/><img class=icon-text src=https://blog.nobugware.com/img/prev.svg></a></li><li><a href=https://blog.nobugware.com/about>About</a></li><li><a href=https://blog.nobugware.com/post/>Post</a></li></ul></nav></div></header><main class=container><article><header><hgroup id=brand><h1>An application to map and store your IoT devices data</h1><h5><time datetime="2019-11-29 06:00:00 +0000 UTC">Nov 29, 2019</time>
<span class=no-print>-
<a href=https://blog.nobugware.com/tags/go>go</a>
<a href=https://blog.nobugware.com/tags/geo>geo</a>
<span></h5></hgroup><hr class=sep></header><p>Here in Quebec, winter is so cold it can drain your phone battery very fast.<br>I wanted a private and secure solution for my hikes, so I can be followed on a map.</p><p>This post will introduce you to LoRaWAN and how to install your own IoT mapping application using open source tools and a <a href=https://github.com/akhenakh/geottn>new project I&rsquo;m working on</a> written in Go.</p><h2 id=radio-network>Radio Network</h2><p><a href=https://en.wikipedia.org/wiki/LoRa#LoRaWAN>LoRaWAN</a> is a network layer protocol for managing communication between LoRa devices and gateways.</p><p><a href=http://www.thethingsnetwork.org>The Things Network</a> is an open and free to use LoRaWAN network.</p><p>Anyone can <a href=https://www.thethingsnetwork.org/community>contribute to the coverage</a> by installing a gateway (a small radio devices) connected to the internet.</p><p>This network is for IoT and only allows a few bytes to be transmitted every several minutes per devices, do not expect browsing the Internet through LoRaWAN.</p><p>All transmissions are ciphered using AES and only you and The Things Network can then read the data.</p><h2 id=gateways>Gateways</h2><p>Gateways are radio emitter/receiver, it can be as small as a $10 devices or a more complete solutions like the <a href=https://www.thethingsnetwork.org/docs/gateways/thethingsindoor/>The Things Indoor Gateway</a> and <a href=https://www.thethingsnetwork.org/marketplace/products/devices>more</a></p><p>An <a href=https://www.cnx-software.com/2017/10/13/this-ttgo-board-combines-esp32-lora-radio-and-oled-display-for-just-10/>ESP32 with a LoRa chip</a> can act <a href=https://github.com/things4u/ESP-1ch-Gateway-v5.0>as a one channel gateway</a>.</p><p>You don&rsquo;t need to own a gateway, to use the network, as long as your area is covered already.</p><h2 id=devices>Devices</h2><p>A devices is a small transceiver, that can generally run on battery or USB consuming a few mA, it&rsquo;s coupled to captors providing humidity, temperature, GPS&mldr;</p><p>Another simple and cheap device you can program: a <a href=https://www.hackster.io/news/the-ttgo-t-beam-an-esp32-lora-board-d44b08f18628>TTGO T-Beam</a>, an ESP32 + LoRa module with a 18650 battery holder.</p><p><a href=https://gist.github.com/akhenakh/c26a2154479e048132c1f8276bf5859c>Here is the code I use for a TTGO T-Beam code for v0.7 (the 2 push buttons one)</a></p><h2 id=map>Map</h2><p>The Thing Network is acting as a hub and provides API for <a href=https://www.thethingsnetwork.org/marketplace/products/integrations>third parties integrations</a> to consume the data.<br>Some of them are providing storage and mapping services, but you have to give them your data.</p><p>That&rsquo;s why I&rsquo;ve developed <a href=https://github.com/akhenakh/geottn>GeoTTN</a>, a simple self hosted solution to gather and store your devices data.</p><h2 id=geottn>GeoTTN</h2><p>GeoTTN is a multi components app put all together:</p><ul><li>A <a href=https://github.com/dgraph-io/badger>Badger</a> storage database using <a href=https://s2geometry.io/>S2</a> as a geographical indexing system</li><li>A client of the Things Network gRPC API to receive uplink messages</li><li>A gRPC API to query the Badger database</li><li>A web frontend to display the devices on a map</li></ul><p>It&rsquo;s shipped in one app on purpose to run inside a one Docker instance, without resorting to complex admin tasks.<br>It should be fine for thousands of devices until you want to break the components apart, contact me for a more robust clustered solution.</p><p>The code is modular so you can change it for your own purpose.</p><p>But most important you can deploy it yourself and own your data.</p><p><img src=https://blog.nobugware.com/img/geottn.jpg alt="example image"></p><h2 id=deployment>Deployment</h2><p>You need to create an &ldquo;application&rdquo; on <a href=https://console.thethingsnetwork.org/>The Thing Network Console</a> and register your devices with this application.</p><p>Then start GeoTTN by simply passing your <code>appID</code> & <code>appAccessKey</code> on the command line or via environment.</p><p>You can also use the docker image as follow:</p><pre><code>docker run -it akhenakh/geottn:latest -e APPID=myappid -e APPACCESSKEY=xxxxxxxxxx -e DBPATH=/data/geo.db -e TILESKEY=pk.eyJxxxxxxxxxxxxxxxxxxxx  -v /mysafesotorage/volume:/data
</code></pre><p>For the map to show up register with MapBox for a free token and pass it as <code>tilesKey</code>.<br>Note that you can use the <a href=https://blog.nobugware.com/post/2019/self_hosted_world_maps/>self hosted map solution described on this very same blog</a> with <code>selfHostedMap=true</code>.</p><h2 id=notes>Notes</h2><p>For your devices registrations, it&rsquo;s recommended to use Over The Air Activation: OTAA, but it could be easier to use <a href=https://www.thethingsnetwork.org/docs/devices/registration.html#personalize-device-for-abp>ABP mode</a>.</p><p>Feel free to contribute, <a href=https://github.com/akhenakh/geottn>GeoTTN</a> is on <a href=https://github.com/akhenakh/geottn>Github</a>.</p></article><nav class="no-print post-nav"><a class=prev-post href=https://blog.nobugware.com/post/2019/nomad_an_alternative_to_kubernetes/><img class=icon-text src=https://blog.nobugware.com/img/prev.svg>Nomad an alternative to Kubernetes</a>
<a class=next-post href=https://blog.nobugware.com/post/2019/time_series_storage_for_coordinates/>A Time Series Storage for Coordinates<img class=icon-text src=https://blog.nobugware.com/img/next.svg></a></nav><section id=related><h4>See Also</h4><ul><li><a href=https://blog.nobugware.com/post/2019/self_hosted_world_maps/>Self Hosted World Maps</a></li><li><a href=https://blog.nobugware.com/post/2018/wasm_go_s2_javascript/>Wasm with Go to build an S2 cover map viewer</a></li><li><a href=https://blog.nobugware.com/post/2019/nomad_an_alternative_to_kubernetes/>Nomad an alternative to Kubernetes</a></li></ul></section><hr class=sep></main><footer class="container no-print"><div class=u-footer><a href=https://github.com/akhenakh/><img class=icon-social src=https://blog.nobugware.com/img/github.svg alt=Github></a>
<a href=https://twitter.com/akhenakh><img class=icon-social src=https://blog.nobugware.com/img/twitter.svg alt=Twitter></a>
<a href=https://blog.nobugware.com/index.xml target=_blank><img class=icon-social src=https://blog.nobugware.com/img/feed.svg alt=Feed></a><p>Theme used: <a href=https://github.com/yursan9/manis-hugo-theme>Manis</a><br></p><a href=#brand><img class=icon-text src=https://blog.nobugware.com/img/toup.svg alt="To Up">
<span>Back to Up</span></a></div></footer><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-1245966-1','auto');ga('send','pageview');</script></body></html>