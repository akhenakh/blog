<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A 10 minutes walk into Grafana &amp; Influxdb &middot; Fabrice Aneche</title>

    <meta name="description" content="">

    <meta name="generator" content="Hugo 0.33" />
    <meta name="twitter:card" content="summary">
    
    <meta name="twitter:title" content="A 10 minutes walk into Grafana &amp; Influxdb &middot; Fabrice Aneche">
    <meta name="twitter:description" content="">

    <meta property="og:type" content="article">
    <meta property="og:title" content="A 10 minutes walk into Grafana &amp; Influxdb &middot; Fabrice Aneche">
    <meta property="og:description" content="">

    <link href='//fonts.googleapis.com/css?family=Source+Sans+Pro:400,700|Oxygen:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/pure-min.css">
    <!--[if lte IE 8]>
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/grids-responsive-old-ie-min.css">
    <![endif]-->
    <!--[if gt IE 8]><!-->
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/grids-responsive-min.css">
    <!--<![endif]-->

    <link rel="stylesheet" href="https://blog.nobugware.com/css/all.min.css">
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet">

    <link rel="alternate" type="application/rss+xml" title="Fabrice Aneche" href="https://blog.nobugware.com/index.xml" />
    <link href="https://blog.nobugware.com/css/prism.css" rel="stylesheet" />
</head>
<body>


<div id="layout" class="pure-g">
    <div class="sidebar pure-u-1 pure-u-md-1-4">
    <div class="header">
        <hgroup>
            <h1 class="brand-title"><a href="https://blog.nobugware.com">Fabrice Aneche</a></h1>
            <h2 class="brand-tagline"></h2>
        </hgroup>

        <nav class="nav">
            <ul class="nav-list">
                
                <li class="nav-item">
                    <a class="pure-button" href="http://www.nobugware.com"><i class="fa fa-building-o"></i> Hiring</a>
                </li>
                
                
                <li class="nav-item">
                    <a class="pure-button" href="https://twitter.com/akhenakh"><i class="fa fa-twitter"></i> Twitter</a>
                </li>
                
                
                <li class="nav-item">
                    <a class="pure-button" href="https://github.com/akhenakh "><i class="fa fa-github-alt"></i> github</a>
                </li>
                
                <li class="nav-item">
                    <a class="pure-button" href="https://blog.nobugware.com/index.xml"><i class="fa fa-rss"></i> rss</a>
                </li>
            </ul>
        </nav>
    </div>
</div>


    <div class="content pure-u-1 pure-u-md-3-4">
        <div>
            
            <div class="posts">
                <h1 class="content-subhead">02 Apr 2015, 12:49</h1>
                <section class="post">
                    <header class="post-header">

                        <a href="https://blog.nobugware.com/post/2015/04/grafana_influxdb/" class="post-title">A 10 minutes walk into Grafana &amp; Influxdb</a>

                        <p class="post-meta">
                            
                            
                                under 
                                
                                <a class="post-category post-category-Golang" href="https://blog.nobugware.com/categories/golang">Golang</a>
                            
                        </p>
                    </header>

                    <div class="post-share">
                        <div class="post-share-links">
                            <h4 style="">Share</h4>
                            <a href="#" data-type="facebook" data-url="https://blog.nobugware.com/post/2015/04/grafana_influxdb/" data-title="A 10 minutes walk into Grafana &amp; Influxdb" data-description="A 10 minutes walk into Grafana &amp; Influxdb" data-media="" class="prettySocial fa fa-facebook"></a>
                            <a href="#" data-type="googleplus" data-url="https://blog.nobugware.com/post/2015/04/grafana_influxdb/" data-description="A 10 minutes walk into Grafana &amp; Influxdb" class="prettySocial fa fa-google-plus"></a>
                            <a href="#" data-type="twitter" data-url="https://blog.nobugware.com/post/2015/04/grafana_influxdb/" data-description="A 10 minutes walk into Grafana &amp; Influxdb" data-via="akhenakh" class="prettySocial fa fa-twitter"></a>
                            
                        </div>
                    </div>
                    <div class="post-description">
                        <p>This is a 10 minute tutorial to set up an <a href="http://influxdb.com/">InfluxDB</a> + <a href="http://grafana.org/">Grafana</a> with Go on your Mac, but should work with minor modifcations on your favorite Unix too, it assumes you already have a working Go compiler.</p>

<p><a href="http://influxdb.com/">InfluxDB</a> is a database specialized into time series, think store everything associated with a time, makes it perfect for monitoring and graphing values.
<a href="http://grafana.org/">Grafana</a> is a js frontend capable of reading the data from InfluxDB and graphing it.</p>

<p><code>brew install influxdb</code></p>

<p>Start <a href="http://influxdb.com/">InfluxDB</a>, and then point your browser to <a href="http://localhost:8083">http://localhost:8083</a> default user is root, password is root and default port is 8086.</p>

<p><code>influxdb -config /usr/local/etc/influxdb.conf</code>
Create a database called test.</p>

<p>Let&rsquo;s test the connection with the db and Go, first install the InfluxDB driver for Go:</p>

<p><code>go get github.com/influxdb/influxdb/client</code>
Test your setup with some code:</p>

<pre><code class="language-go">package main

import (
    &quot;fmt&quot;

    &quot;github.com/influxdb/influxdb/client&quot;
)

func main() {
    c, err := client.NewClient(&amp;client.ClientConfig{
        Username: &quot;root&quot;,
        Password: &quot;root&quot;,
        Database: &quot;test&quot;,
    })

    if err != nil {
        panic(err)
    }

    dbs, err := c.GetDatabaseList()
    if err != nil {
        panic(err)
    }

    fmt.Println(dbs)
}
</code></pre>

<p>If you are good you should see a map containing all your created <a href="http://influxdb.com/">InfluxDB</a> databases.</p>

<p>Now let&rsquo;s measure something real: the time it takes for your http handler to answer.</p>

<pre><code class="language-go">package main

import (
    &quot;fmt&quot;
    &quot;log&quot;
    &quot;math/rand&quot;
    &quot;net/http&quot;
    &quot;time&quot;

    &quot;github.com/influxdb/influxdb/client&quot;
)

var c *client.Client

func mySuperFastHandler(rw http.ResponseWriter, r *http.Request) {
    start := time.Now()
    // sleeping some random time
    rand.Seed(time.Now().Unix())
    i := rand.Intn(1000)
    time.Sleep(time.Duration(time.Duration(i) * time.Millisecond))
    fmt.Fprintf(rw, &quot;Waiting %dms&quot;, i)
    t := time.Since(start)

    // sending the serie
    s := &amp;client.Series{
        Name:    &quot;myhostname.nethttp.mySuperFastHandler.resp_time&quot;,
        Columns: []string{&quot;duration&quot;, &quot;code&quot;, &quot;url&quot;, &quot;method&quot;},
        Points: [][]interface{}{
            []interface{}{int64(t / time.Millisecond), 200, r.RequestURI, r.Method},
        },
    }
    err := c.WriteSeries([]*client.Series{s})
    if err != nil {
        log.Println(err)
    }
}

func main() {
    var err error
    c, err = client.NewClient(&amp;client.ClientConfig{
        Username: &quot;root&quot;,
        Password: &quot;root&quot;,
        Database: &quot;test&quot;,
    })
    if err != nil {
        panic(err)
    }

    http.HandleFunc(&quot;/&quot;, mySuperFastHandler)
    http.ListenAndServe(&quot;:8080&quot;, nil)
}
</code></pre>

<p>This is not very useful as it&rsquo;s measuring the time to write to the ResponseWriter that&rsquo;s why I&rsquo;ve added some random time but you get the sense.
It will save a serie per request as: duration, status code, url, http method, the name of the serie is important as many tools (as Graphite) are using the dots as separator, so think twice before naming your serie.
Point your browser to <a href="http://localhost:8080">http://localhost:8080</a> and reload the page several times.</p>

<p>Now that we have data let&rsquo;s browse them with the <a href="http://influxdb.com/">InfluxDB</a> browser, go to the <a href="http://influxdb.com/">InfluxDB</a> admin and hit &ldquo;explore data&rdquo; and select with:</p>

<p><code>SELECT duration FROM myhostname.nethttp.mySuperFastHandler.resp_time WHERE code = 200;</code></p>

<p><img src="http://kdl.nobugware.com/public/shotinflux.png" alt="Image Alt" /></p>

<p>You should be able to see the inserted data points.</p>

<p>Now let&rsquo;s work with <a href="http://grafana.org/">Grafana</a>, download the tar gz, uncompress it somewhere, <a href="https://gist.githubusercontent.com/akhenakh/39e1950bf95859878748/raw/f8b0531d88cfb481213541253329c5730c4a2b06/config.js">copy this demo config.js</a> file in the root directory of <a href="http://grafana.org/">Grafana</a>.
Go to the <a href="http://influxdb.com/">InfluxDB</a> admin with your browser and add a new database called &ldquo;grafana&rdquo;.</p>

<p>In your web browser, open the file index.html in the <a href="http://grafana.org/">Grafana</a> directory, you should see a the <a href="http://grafana.org/">Grafana</a> interface edit the default graph, enter the query as follow:</p>

<ul>
<li>click on series it will complete with myhostname.nethttp.mySuperFastHandler.resp_time</li>
<li>In alias type $0 $2, it will use the 1st part and the 3rd part of the name (remember the dots) so it will display myhostname mySuperFastHandler</li>
<li>Finally click on mean and choose duration in the completion, then add code = 200 as where clause.<br /></li>
</ul>

<p>Hit save and you are done !</p>

<p><img src="http://kdl.nobugware.com/public/shotgrafana.png" alt="Image Alt" /></p>

<p>There is so much more you can do with <a href="http://influxdb.com/">InfluxDB</a> &amp; <a href="http://grafana.org/">Grafana</a>, it&rsquo;s really simple to collect and display, hope you want to go further after this.
You can look at my <a href="https://github.com/akhenakh/influxhandler">generic net/http handler for <a href="http://influxdb.com/">InfluxDB</a> on Github</a> that can be integrated into your code.</p>

                    </div>
                </section>
            </div>
            <div class="footer">
    <div class="pure-menu pure-menu-horizontal pure-menu-open">
        <ul>
            <li>Powered by <a class="hugo" href="http://hugo.spf13.com/" target="_blank">hugo</a></li>
        </ul>
    </div>
</div>
<script src="https://blog.nobugware.com/js/all.min.js"></script>
        </div>
    </div>
</div>


<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-1245966-1', 'auto');
ga('send', 'pageview');

</script>

</body>
</html>
