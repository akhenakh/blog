<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.74.2"><title>C++ bindings in Go and Swig - Fabrice Aneche</title><meta name=description content="Swig is a tool to generate bindings for c/c++, it can produce bindings for Python, Java, Go and more.
Unfortunately Swig for Go is very limited, so as the Swig & Go documentation.
Here are some notes taken while writing a binding from c++ to Go:
To bind standard types into Golang Let&rsquo;s look at this c++ function:
int64_t Ticks() const; Simply include sdtint into Swig
%include &#34;stdint.i&#34; It will translate into Go"><link rel=stylesheet href=https://blog.nobugware.com/css/ui.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Fira+Mono|Lato|Raleway"></head><body><header class="container no-print"><div class=u-header><nav class=bar><ul><li><a href=https://blog.nobugware.com/><img class=icon-text src=https://blog.nobugware.com/img/prev.svg></a></li><li><a href=https://blog.nobugware.com/about>About</a></li><li><a href=https://blog.nobugware.com/post/>Post</a></li></ul></nav></div></header><main class=container><article><header><hgroup id=brand><h1>C++ bindings in Go and Swig</h1><h5><time datetime="2020-04-11 04:00:00 +0000 UTC">Apr 11, 2020</time>
<span class=no-print>-
<a href=https://blog.nobugware.com/tags/go>go</a>
<a href=https://blog.nobugware.com/tags/c++>c++</a>
<a href=https://blog.nobugware.com/tags/swig>swig</a>
<span></h5></hgroup><hr class=sep></header><p><a href=http://swig.org/>Swig</a> is a tool to generate bindings for c/c++, it can produce bindings for Python, Java, Go and more.</p><p>Unfortunately Swig for Go is very limited, so as the <a href=http://www.swig.org/Doc4.0/Go.html>Swig & Go documentation</a>.<br>Here are some notes taken while writing a binding from c++ to Go:</p><h2 id=to-bind-standard-types-into-golang>To bind standard types into Golang</h2><p>Let&rsquo;s look at this c++ function:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++><span style=color:#66d9ef>int64_t</span> <span style=color:#a6e22e>Ticks</span>() <span style=color:#66d9ef>const</span>;
</code></pre></div><p>Simply include <code>sdtint</code> into Swig</p><pre><code class=language-swig data-lang=swig>%include &quot;stdint.i&quot;
</code></pre><p>It will translate into Go</p><pre><code>func Ticks() int64
</code></pre><h2 id=to-bind-stdstring-as-go-string>To bind <code>std::string</code> as Go <code>string</code></h2><p>Includes <code>std_string.i</code> to transform them into <code>string</code></p><pre><code class=language-swig data-lang=swig>%include &quot;std_string.i&quot;
</code></pre><h2 id=using-stdlist--stdvector>Using <code>std::list</code> & <code>std::vector</code></h2><p>This example function returns a vector of structs.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++>std<span style=color:#f92672>::</span>vector<span style=color:#f92672>&lt;</span><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>PassDetails</span><span style=color:#f92672>&gt;</span> GeneratePassList(
                                               <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>double</span> lat,
                                               <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>double</span> lng);
</code></pre></div><p>Help Swig with these imports</p><pre><code class=language-swig data-lang=swig>%include &lt;typemaps.i&gt;
%include &quot;std_vector.i&quot;

namespace std {
   %template(PassDetailsVector) vector&lt;PassDetails&gt;;
}
</code></pre><p>Translates into Go</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>GeneratePassList</span>(<span style=color:#a6e22e>arg1</span> <span style=color:#66d9ef>float64</span>, <span style=color:#a6e22e>arg2</span> <span style=color:#66d9ef>float64</span>) (<span style=color:#a6e22e>_swig_ret</span> <span style=color:#a6e22e>PassDetailsVector</span>) 
</code></pre></div><p>Then use the generated helpers to access the elements</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#a6e22e>cdetails</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>cppsgp4</span>.<span style=color:#a6e22e>GeneratePassList</span>(<span style=color:#a6e22e>lat</span>, <span style=color:#a6e22e>lng</span>)
<span style=color:#66d9ef>for</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>:=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> &lt; int(<span style=color:#a6e22e>cdetails</span>.<span style=color:#a6e22e>Capacity</span>()); <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span> {
  <span style=color:#a6e22e>cpd</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>cdetails</span>.<span style=color:#a6e22e>Get</span>(<span style=color:#a6e22e>i</span>)
  <span style=color:#f92672>...</span>
}
</code></pre></div><h2 id=transforming-c-exceptions-into-go-errors>Transforming c++ exceptions into Go errors</h2><p>Tell swig about it:</p><pre><code class=language-swig data-lang=swig>%include &quot;exception.i&quot;
%exception {
    try {
        $action;
    } catch (std::runtime_error &amp;e) {
        _swig_gopanic(e.what());
    }
}
</code></pre><p>Here is a c++ class which can raise exceptions</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Tle</span> {
<span style=color:#66d9ef>public</span><span style=color:#f92672>:</span>
    Tle(<span style=color:#66d9ef>const</span> std<span style=color:#f92672>::</span>string<span style=color:#f92672>&amp;</span> line_one, <span style=color:#66d9ef>const</span> std<span style=color:#f92672>::</span>string<span style=color:#f92672>&amp;</span> line_two);
</code></pre></div><p>Wrap the real function into yours, catch the panic and transform into error</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>TLE</span> <span style=color:#66d9ef>struct</span> {
    <span style=color:#a6e22e>ctle</span> <span style=color:#a6e22e>cppsgp4</span>.<span style=color:#a6e22e>Tle</span>
}

<span style=color:#66d9ef>func</span> <span style=color:#a6e22e>NewTLE</span>(<span style=color:#a6e22e>tle1</span>, <span style=color:#a6e22e>tle2</span> <span style=color:#66d9ef>string</span>) (<span style=color:#a6e22e>tle</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>TLE</span>, <span style=color:#a6e22e>err</span> <span style=color:#66d9ef>error</span>) {
    <span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>catch</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>err</span>)
    <span style=color:#a6e22e>ctle</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>cppsgp4</span>.<span style=color:#a6e22e>NewTle</span>(<span style=color:#a6e22e>tle1</span>, <span style=color:#a6e22e>tle2</span>)

    <span style=color:#a6e22e>tle</span> = <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>TLE</span>{<span style=color:#a6e22e>ctle</span>: <span style=color:#a6e22e>ctle</span>}
    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>tle</span>, <span style=color:#66d9ef>nil</span>
}
</code></pre></div><h2 id=invocation>Invocation</h2><pre><code>swig -c++ -intgosize 64 -go myfile.i
</code></pre><p>Go can find your swig file if they end with the<code>.swig</code>extension.</p><h2 id=example>Example</h2><p>I&rsquo;m writing a <a href=https://github.com/akhenakh/sataas/>binding for a satellites pass prediction</a>, you may find some codes useful.</p></article><nav class="no-print post-nav"><a class=prev-post href=https://blog.nobugware.com/post/2020/free-maps-for-all/><img class=icon-text src=https://blog.nobugware.com/img/prev.svg>Free Maps For All</a></nav><section id=related><h4>See Also</h4><ul><li><a href=https://blog.nobugware.com/post/2020/free-maps-for-all/>Free Maps For All</a></li><li><a href=https://blog.nobugware.com/post/2019/time_series_storage_for_coordinates/>A Time Series Storage for Coordinates</a></li><li><a href=https://blog.nobugware.com/post/2019/an_application_for__mapping_storing_your_iot_devices_data/>An application to map and store your IoT devices data</a></li></ul></section><hr class=sep></main><footer class="container no-print"><div class=u-footer><a href=https://github.com/akhenakh/><img class=icon-social src=https://blog.nobugware.com/img/github.svg alt=Github></a>
<a href=https://twitter.com/akhenakh><img class=icon-social src=https://blog.nobugware.com/img/twitter.svg alt=Twitter></a>
<a href=https://blog.nobugware.com/index.xml target=_blank><img class=icon-social src=https://blog.nobugware.com/img/feed.svg alt=Feed></a><p>Theme used: <a href=https://github.com/yursan9/manis-hugo-theme>Manis</a><br></p><a href=#brand><img class=icon-text src=https://blog.nobugware.com/img/toup.svg alt="To Up">
<span>Back to Up</span></a></div></footer><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-1245966-1','auto');ga('send','pageview');</script></body></html>