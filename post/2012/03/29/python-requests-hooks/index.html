<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.123.7"><title>Python Requests hooks - Fabrice Aneche</title>
<meta name=description content="Python requests is the de facto HTTP package for Python, nice API, wonderful documentation.
I had the need to sign my requests and to change the header after the request was built, [here is hooks](http://docs.python- requests.org/en/v0.10.7/user/advanced/#event-hooks), simply call a function pre_request and your are done:
def auth_sign(req): user_id = '4f47a5f21aebcedff3001234' secret_key = 'C21LHQ5R4RVO2U2UMTEZ' timestamp = str(int(time.mktime(time.gmtime()))) string_to_sign = req.method + '\n' + user_id + '\n' + timestamp + '\n' + req."><link rel=stylesheet href=https://blog.nobugware.com/css/ui.css><script defer src=https://blog.nobugware.com/js/dark-mode.js></script><link disabled id=dark-mode-theme rel=stylesheet href=https://blog.nobugware.com/css/dark.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Fira+Mono|Lato|Raleway"><link rel=stylesheet href=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/ocean.min.css><script src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js></script><script src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.4.0/languages/go.min.js></script><script src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.4.0/languages/yaml.min.js></script></head><body><header class="container no-print"><div class=u-header><nav class=bar><ul><li><a href=https://blog.nobugware.com/><img class=icon-text src=https://blog.nobugware.com/img/prev.svg></a></li><li><img class=icon-text id=dark-mode-toggle src=https://blog.nobugware.com/img/moon-regular.svg alt="Toggle Dark Mode"></a></li><li><a href=https://blog.nobugware.com/about>About</a></li><li><a href=https://blog.nobugware.com/post/>Post</a></li></ul></nav></div></header><main class=container><article><header><hgroup id=brand><h1>Python Requests hooks</h1><h5><time datetime="2012-03-29 08:23:50 -0400 -0400">Mar 29, 2012</time>
<span class=no-print>-
<a href=https://blog.nobugware.com/tags/python>python</a>
<a href=https://blog.nobugware.com/tags/requests>requests</a>
<span></h5></hgroup><hr class=sep></header><p><a href=http://docs.python-requests.org>Python requests</a> is the de facto HTTP
package for Python, nice API, wonderful documentation.</p><p>I had the need to sign my requests and to change the header after the request
was built, [here is hooks](<a href=http://docs.python>http://docs.python</a>-
requests.org/en/v0.10.7/user/advanced/#event-hooks), simply call a function
pre_request and your are done:</p><pre tabindex=0><code>def auth_sign(req):
user_id = &#39;4f47a5f21aebcedff3001234&#39;
secret_key = &#39;C21LHQ5R4RVO2U2UMTEZ&#39;
timestamp = str(int(time.mktime(time.gmtime())))
string_to_sign = req.method + &#39;\n&#39; + user_id + &#39;\n&#39; + timestamp + &#39;\n&#39; + req.path_url + &#39;\n&#39; + req._enc_data

sign = base64.b64encode(hmac.new(secret_key, string_to_sign,
hashlib.sha256).digest())

headers = {&#39;X-User-ID&#39;:user_id, &#39;X-Expires&#39;:timestamp, &#39;X-Signature&#39;:sign}
req.headers.update(headers)
payload = {&#39;name&#39;:&#39;Test event&#39;, &#39;description&#39;:&#39;Description blabla&#39;, &#39;category&#39;:&#39;1&#39;}
r = requests.post(API_URL + &#39;event&#39;, data=payload, hooks={&#39;pre_request&#39;:auth_sign})
</code></pre><p>And remember to use <a href=https://github.com/jkbr/httpie>httpie</a> Curl for human
which is using requests</p></article><nav class="no-print post-nav"><a class=prev-post href=https://blog.nobugware.com/post/2012/02/28/freebsd-vimage-jails/><img class=icon-text src=https://blog.nobugware.com/img/prev.svg>FreeBSD vimage jails</a>
<a class=next-post href=https://blog.nobugware.com/post/2012/10/16/appcode-shortcuts/>Appcode shortcuts<img class=icon-text src=https://blog.nobugware.com/img/next.svg></a></nav><section id=related><h4>See Also</h4><ul><li><a href=https://blog.nobugware.com/post/2011/11/15/compile-gevent-osx-or-freebsd-pip/>compile gevent on OSX or FreeBSD with pip</a></li><li><a href=https://blog.nobugware.com/post/2011/08/16/enhance-your-python/>Enhance your Python</a></li><li><a href=https://blog.nobugware.com/post/2010/11/08/jmx-query-python-cpython/>JMX query in Python (CPython)</a></li></ul></section><hr class=sep></main><footer class="container no-print"><div class=u-footer><a href=https://github.com/akhenakh/><img class=icon-social src=https://blog.nobugware.com/img/github.svg alt=Github></a>
<a href=https://c.im/@akhenakh><img class=icon-social src=https://blog.nobugware.com/img/mastodon.svg alt=Mastodon></a>
<a href=https://twitter.com/akhenakh><img class=icon-social src=https://blog.nobugware.com/img/twitter.svg alt=Twitter></a><p>Theme used: <a href=https://github.com/yursan9/manis-hugo-theme>Manis</a><br></p><a href=#brand><img class=icon-text src=https://blog.nobugware.com/img/toup.svg alt="To Up">
<span>Back to Up</span></a></div></footer><script>hljs.initHighlightingOnLoad()</script></body></html>